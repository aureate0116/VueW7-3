import{M}from"./bootstrap.esm-434bcbc7.js";import{p as x}from"./PaginationComponent-eb925a56.js";import{_ as C,r as E,o,c as a,a as t,F as c,e as u,b as V,t as n,g as v,k as w}from"./index-75d2aa51.js";const{VITE_API_URL:_,VITE_API_PATH:h}={VITE_API_URL:"https://vue3-course-api.hexschool.io/v2",VITE_API_PATH:"rena",BASE_URL:"/VueW7-3",MODE:"production",DEV:!1,PROD:!0,SSR:!1};let D=null;const A={props:["checkAdmin"],data(){return{orders:[],tempOrder:{},page:{},isLoading:!1}},components:{pagination:x},methods:{getOrders(d=1){this.isLoading=!0,this.$http.get(`${_}/api/${h}/admin/orders?page=${d}`).then(l=>{this.orders=l.data.orders,this.page=l.data.pagination,this.isLoading=!1,console.log(l.data.orders)}).catch(l=>{this.isLoading=!0,alert(l.response.data.message)})},openOrderModal(d){this.tempOrder={...d},D.show()},updatePaid(d){this.isLoading=!0,this.$http.put(`${_}/api/${h}/admin/order/${d.id}`,{data:{is_paid:d.is_paid}}).then(l=>{alert(l.data.message),this.getOrders(),this.isLoading=!1}).catch(l=>{this.isLoading=!1,alert(l.response)})},deleteOrder(d){this.isLoading=!0,this.$http.delete(`${_}/api/${h}/admin/order/${d.id}`).then(l=>{this.isLoading=!1,alert(l.data.message),location.reload()}).catch(l=>{this.isLoading=!0,alert(l.response.data.message)})}},mounted(){this.checkAdmin(),this.getOrders(),D=new M(document.getElementById("orderModal"))}},P=t("h3",{class:"fw-bold"},"後台訂單列表",-1),I={key:0},$=t("p",null,"目前尚未有訂單",-1),S=[$],T={key:1,class:"table table-striped mt-5"},U=t("thead",null,[t("tr",null,[t("th",null,"訂單時間"),t("th",null,"Email"),t("th",null,"購買品項"),t("th",null,"應付金額"),t("th",null,"是否付款"),t("th",null,"編輯")])],-1),B={class:"form-check form-switch"},R=["id","onUpdate:modelValue","onChange"],F=["for"],H={key:0},q={key:1},N={class:"btn-group"},Y=["onClick"],j=["onClick"],W={class:"modal fade",id:"orderModal",tabindex:"-1","aria-labelledby":"orderModalLabel","aria-hidden":"true"},z={class:"modal-dialog modal-xl"},G={class:"modal-content"},J=t("div",{class:"modal-header"},[t("h5",{class:"modal-title",id:"orderModalLabel"},"訂單資訊"),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),K={class:"modal-body"},Q={class:"row"},X={class:"col"},Z=t("h3",{class:"fw-bold"},"用戶資料",-1),tt=t("th",null,"姓名",-1),et=t("th",null,"Email",-1),st=t("th",null,"地址",-1),lt=t("th",null,"電話",-1),nt={class:"col"},ot=t("h3",{class:"fw-bold"},"訂單資訊",-1),at=t("th",null,"訂單編號",-1),dt=t("th",null,"訂單時間",-1),it=t("th",null,"付款狀態",-1),rt={key:0,class:"fw-bold text-primary"},ct={key:1,class:"fw-bold text-danger"},ut=t("th",null,"總金額",-1),_t=t("h3",{class:"fw-bold"},"購買品項",-1),ht={class:"text-end"},pt={class:"d-flex justify-content-end"},mt={class:"form-check"},bt={class:"form-check-label",for:"paidCheck"},gt={key:0},ft={key:1},yt={class:"modal-footer"},kt=t("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function Ot(d,l,vt,wt,s,r){var p,m,b,g,f,y,k,O;const L=E("pagination");return o(),a(c,null,[P,s.orders.length===0?(o(),a("div",I,S)):(o(),a("table",T,[U,t("tbody",null,[(o(!0),a(c,null,u(s.orders,e=>(o(),a("tr",{key:e.id},[t("td",null,n(`${new Date(e.create_at*1e3).getFullYear()}-${new Date(e.create_at*1e3).getMonth()+1}-${new Date(e.create_at*1e3).getDate()} ${new Date(e.create_at*1e3).getHours()} : ${new Date(e.create_at*1e3).getMinutes()}`),1),t("td",null,n(e.user.email),1),t("td",null,[(o(!0),a(c,null,u(e.products,i=>(o(),a("p",{key:i.products},n(i.product.title)+" (數量 : "+n(i.qty)+" "+n(i.product.unit)+") ",1))),128))]),t("td",null,n(e.total),1),t("td",null,[t("div",B,[v(t("input",{class:"form-check-input",type:"checkbox",id:`paidState${e.id}`,"onUpdate:modelValue":i=>e.is_paid=i,onChange:i=>r.updatePaid(e)},null,40,R),[[w,e.is_paid]]),t("label",{class:"form-check-label",for:`paidState${e.id}`},[e.is_paid?(o(),a("span",H,"已付款")):(o(),a("span",q,"未付款"))],8,F)])]),t("td",null,[t("div",N,[t("button",{type:"button",class:"btn btn-outline-primary btn-sm",onClick:i=>r.openOrderModal(e)}," 檢視 ",8,Y),t("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:i=>r.deleteOrder(e)}," 刪除 ",8,j)])])]))),128))])])),V(L,{pages:s.page,"get-products":r.getOrders},null,8,["pages","get-products"]),t("div",W,[t("div",z,[t("div",G,[J,t("div",K,[t("div",Q,[t("div",X,[Z,t("table",null,[t("tbody",null,[t("tr",null,[tt,t("td",null,n((m=(p=s.tempOrder)==null?void 0:p.user)==null?void 0:m.name),1)]),t("tr",null,[et,t("td",null,n((g=(b=s.tempOrder)==null?void 0:b.user)==null?void 0:g.email),1)]),t("tr",null,[st,t("td",null,n((y=(f=s.tempOrder)==null?void 0:f.user)==null?void 0:y.address),1)]),t("tr",null,[lt,t("td",null,n((O=(k=s.tempOrder)==null?void 0:k.user)==null?void 0:O.tel),1)])])])]),t("div",nt,[ot,t("table",null,[t("tbody",null,[t("tr",null,[at,t("td",null,n(s.tempOrder.id),1)]),t("tr",null,[dt,t("td",null,n(`${new Date(s.tempOrder.create_at*1e3).getFullYear()}-${new Date(s.tempOrder.create_at*1e3).getMonth()+1}-${new Date(s.tempOrder.create_at*1e3).getDate()} ${new Date(s.tempOrder.create_at*1e3).getHours()} : ${new Date(s.tempOrder.create_at*1e3).getMinutes()}`),1)]),t("tr",null,[it,t("td",null,[s.tempOrder.is_paid?(o(),a("span",rt,"已付款")):(o(),a("span",ct,"未付款"))])]),t("tr",null,[ut,t("td",null,n(s.tempOrder.total),1)])])]),_t,t("table",null,[t("tbody",null,[(o(!0),a(c,null,u(s.tempOrder.products,e=>(o(),a("tr",{key:e.id},[t("th",null,n(e.product.title),1),t("td",null,n(e.qty)+" / "+n(e.product.unit),1),t("td",ht,n(e.final_total),1)]))),128))])]),t("div",pt,[t("div",mt,[v(t("input",{class:"form-check-input",type:"checkbox",value:"",id:"paidCheck","onUpdate:modelValue":l[0]||(l[0]=e=>s.tempOrder.is_paid=e)},null,512),[[w,s.tempOrder.is_paid]]),t("label",bt,[s.tempOrder.is_paid?(o(),a("span",gt,"已付款")):(o(),a("span",ft,"未付款"))])])])])])]),t("div",yt,[kt,t("button",{type:"button",class:"btn btn-primary",onClick:l[1]||(l[1]=e=>r.updatePaid(s.tempOrder))}," 修改付款狀態 ")])])])])],64)}const xt=C(A,[["render",Ot]]);export{xt as default};
