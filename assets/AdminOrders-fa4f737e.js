import{M as f}from"./bootstrap.esm-434bcbc7.js";import{p as k}from"./PaginationComponent-9d231d7d.js";import{_ as y,r as O,o as n,c as a,a as t,F as c,e as u,b as v,t as o,g as h,k as p}from"./index-dde84921.js";const{VITE_API_URL:_,VITE_API_PATH:m}={VITE_API_URL:"https://vue3-course-api.hexschool.io/v2",VITE_API_PATH:"rena",BASE_URL:"/VueW7-3",MODE:"production",DEV:!1,PROD:!0,SSR:!1};let b=null;const w={data(){return{orders:[],tempOrder:{},page:{},isLoading:!1}},components:{pagination:k},methods:{checkAdmin(){const d=document.cookie.replace(/(?:(?:^|.*;\s*)userToken\s*=\s*([^;]*).*$)|^.*$/,"$1");this.$http.defaults.headers.common.Authorization=d,this.$http.post(`${_}/api/user/check`).then(l=>{this.getOrders(),console.log(l),l.data.success||this.$router.push("/login")}).catch(l=>{alert(l.response.data.message),this.$router.push("/login")})},getOrders(d=1){this.isLoading=!0,this.$http.get(`${_}/api/${m}/admin/orders?page=${d}`).then(l=>{this.orders=l.data.orders,this.page=l.data.pagination,this.isLoading=!1}).catch(l=>{this.isLoading=!0,alert(l.response)})},openOrderModal(d){this.tempOrder={...d},b.show()},updatePaid(d){this.isLoading=!0,this.$http.put(`${_}/api/${m}/admin/order/${d.id}`,{data:{is_paid:d.is_paid}}).then(l=>{alert(l.data.message),this.getOrders(),this.isLoading=!1}).catch(l=>{this.isLoading=!1,alert(l.response)})}},mounted(){this.checkAdmin(),b=new f(document.getElementById("orderModal"))}},D=t("h3",{class:"fw-bold"},"後台訂單列表",-1),M={key:0},x=t("p",null,"目前尚未有訂單",-1),L=[x],A={key:1,class:"table table-striped mt-5"},E=t("thead",null,[t("tr",null,[t("th",null,"訂單時間"),t("th",null,"Email"),t("th",null,"購買品項"),t("th",null,"應付金額"),t("th",null,"是否付款"),t("th",null,"編輯")])],-1),V={class:"form-check form-switch"},$=["id","onUpdate:modelValue","onChange"],C=["for"],P={key:0},I={key:1},T={class:"btn-group"},S=["onClick"],U=t("button",{type:"button",class:"btn btn-outline-danger btn-sm"}," 刪除 ",-1),B={class:"modal fade",id:"orderModal",tabindex:"-1","aria-labelledby":"orderModalLabel","aria-hidden":"true"},R={class:"modal-dialog modal-xl"},F={class:"modal-content"},H=t("div",{class:"modal-header"},[t("h5",{class:"modal-title",id:"orderModalLabel"},"訂單資訊"),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),q={class:"modal-body"},N={class:"row"},Y={class:"col"},j=t("h3",{class:"fw-bold"},"用戶資料",-1),z=t("th",null,"姓名",-1),W=t("th",null,"Email",-1),G=t("th",null,"地址",-1),J=t("th",null,"電話",-1),K={class:"col"},Q=t("h3",{class:"fw-bold"},"訂單資訊",-1),X=t("th",null,"訂單編號",-1),Z=t("th",null,"訂單時間",-1),tt=t("th",null,"付款狀態",-1),et={key:0,class:"fw-bold text-primary"},st={key:1,class:"fw-bold text-danger"},lt=t("th",null,"總金額",-1),ot=t("h3",{class:"fw-bold"},"購買品項",-1),nt={class:"text-end"},at={class:"d-flex justify-content-end"},dt={class:"form-check"},it={class:"form-check-label",for:"paidCheck"},rt={key:0},ct={key:1},ut={class:"modal-footer"},_t=t("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function ht(d,l,pt,mt,s,r){const g=O("pagination");return n(),a(c,null,[D,s.orders.length===0?(n(),a("div",M,L)):(n(),a("table",A,[E,t("tbody",null,[(n(!0),a(c,null,u(s.orders,e=>(n(),a("tr",{key:e.id},[t("td",null,o(`${new Date(e.create_at*1e3).getFullYear()}-${new Date(e.create_at*1e3).getMonth()+1}-${new Date(e.create_at*1e3).getDate()} ${new Date(e.create_at*1e3).getHours()} : ${new Date(e.create_at*1e3).getMinutes()}`),1),t("td",null,o(e.user.email),1),t("td",null,[(n(!0),a(c,null,u(e.products,i=>(n(),a("p",{key:i.products},o(i.product.title)+" (數量 : "+o(i.qty)+" "+o(i.product.unit)+") ",1))),128))]),t("td",null,o(e.total),1),t("td",null,[t("div",V,[h(t("input",{class:"form-check-input",type:"checkbox",id:`paidState${e.id}`,"onUpdate:modelValue":i=>e.is_paid=i,onChange:i=>r.updatePaid(e)},null,40,$),[[p,e.is_paid]]),t("label",{class:"form-check-label",for:`paidState${e.id}`},[e.is_paid?(n(),a("span",P,"已付款")):(n(),a("span",I,"未付款"))],8,C)])]),t("td",null,[t("div",T,[t("button",{type:"button",class:"btn btn-outline-primary btn-sm",onClick:i=>r.openOrderModal(e)}," 檢視 ",8,S),U])])]))),128))])])),v(g,{pages:s.page,"get-products":r.getOrders},null,8,["pages","get-products"]),t("div",B,[t("div",R,[t("div",F,[H,t("div",q,[t("div",N,[t("div",Y,[j,t("table",null,[t("tbody",null,[t("tr",null,[z,t("td",null,o(s.tempOrder.user.name),1)]),t("tr",null,[W,t("td",null,o(s.tempOrder.user.email),1)]),t("tr",null,[G,t("td",null,o(s.tempOrder.user.address),1)]),t("tr",null,[J,t("td",null,o(s.tempOrder.user.tel),1)])])])]),t("div",K,[Q,t("table",null,[t("tbody",null,[t("tr",null,[X,t("td",null,o(s.tempOrder.id),1)]),t("tr",null,[Z,t("td",null,o(`${new Date(s.tempOrder.create_at*1e3).getFullYear()}-${new Date(s.tempOrder.create_at*1e3).getMonth()+1}-${new Date(s.tempOrder.create_at*1e3).getDate()} ${new Date(s.tempOrder.create_at*1e3).getHours()} : ${new Date(s.tempOrder.create_at*1e3).getMinutes()}`),1)]),t("tr",null,[tt,t("td",null,[s.tempOrder.is_paid?(n(),a("span",et,"已付款")):(n(),a("span",st,"未付款"))])]),t("tr",null,[lt,t("td",null,o(s.tempOrder.total),1)])])]),ot,t("table",null,[t("tbody",null,[(n(!0),a(c,null,u(s.tempOrder.products,e=>(n(),a("tr",{key:e.id},[t("th",null,o(e.product.title),1),t("td",null,o(e.qty)+" / "+o(e.product.unit),1),t("td",nt,o(e.final_total),1)]))),128))])]),t("div",at,[t("div",dt,[h(t("input",{class:"form-check-input",type:"checkbox",value:"",id:"paidCheck","onUpdate:modelValue":l[0]||(l[0]=e=>s.tempOrder.is_paid=e)},null,512),[[p,s.tempOrder.is_paid]]),t("label",it,[s.tempOrder.is_paid?(n(),a("span",rt,"已付款")):(n(),a("span",ct,"未付款"))])])])])])]),t("div",ut,[_t,t("button",{type:"button",class:"btn btn-primary",onClick:l[1]||(l[1]=e=>r.updatePaid(s.tempOrder))}," 修改付款狀態 ")])])])])],64)}const kt=y(w,[["render",ht]]);export{kt as default};
